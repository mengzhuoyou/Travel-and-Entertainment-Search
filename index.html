<!doctype html>
<html lang="en" ng-app="myApp" ng-controller="validateCtrl">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1.0, user-scalable=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.9/js/all.js" integrity="sha384-8iPTk2s/jMVj81dnzb/iFR2sdA7u06vHJyyLlAd4snFpCl/SnyUjRrbdJsw1pGIl" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/fontawesome.js" integrity="sha384-7ox8Q2yzO/uWircfojVuCQOZl+ZZBg2D2J5nkpLqzH1HY0C1dHlTKIbpRz/LG23c" crossorigin="anonymous"></script>
   <style type="text/css">
    .MainForm{
      /*width:800px;*/
      padding: 10px;
      margin-left: 150px;
      border:1px solid rgb(219,219,219);
      background-color: rgb(248,248,248);
    }

    .MainForm .row{
      margin: 10px 0px;
    }

    .table-hover tbody tr:hover{
      background: lightgray!important;
    }

    .formGroup1{
      width:300px;
    }

    .formGroup2{

    }

    .formGroup3{

    }

    .form-inline{
      margin:20px 0px;
    }

    .star{
      color: red;
      font-size: 100%;
    }

    .locationInput{
      margin-left: 20px;      
      border: 1px solid rgb(226,229,232);
    }

    .Button{
      border:1px solid black;
      background-color: rgb(255,255,255);
    }

    .Button:hover{
      background-color: lightgray;
    }
    .btn-non-choose{
      color:#007bff;
    }

    .dis_false{
      disabled: true;

    }
    
    .dis_true{
      disabled: false;
    }

    .angleRightButton{
      background-color: white; 
      border: solid 1px;
      height: 40px;
      width: -moz-available;
    }

    .detailButton{
      background-color: white; 
      border: solid 1px;
    }


    .center-block {  
        float: none;  
        display: block;  
        margin-left: auto;  
        margin-right: auto;  
    }  

    .photoimg{
      width: 90%;
      border: 1px solid lightgray;
      padding: 5px 5%;
      margin: 5px 5%;
    }

    .reviewsShow-dropdown{
      margin:20px 0px;
    }

    .reviewsShow img{
      width: 70px;
      height: 70px;
      margin-top: 10px;
    }

#UserForm .invalid-true input{
  border: 2px solid #dc3545;
}
#UserForm .invalid-true .invalid-feedback{
  display: block;
}

.fade-review{
  opacity:1;
}
.fade-review.ng-hide{
  opacity:0;
}

.fade-review.ng-hide-add,
.fade-review.ng-hide-remove {
    transition: all linear 0.5s;
}

  .angleRightButton.ng-enter,.angleRightButton.ng-move,.angleRightButton.ng-leave{
    transition: all linear 0s;
  }
  .angleRightButton.ng-hide-add, .angleRightButton.ng-hide-remove {
    transition: all linear 0s;
  }



#progress{
  display: none;
  margin:20px 0px;
}
#progress .progress-bar{
  height: 100%;
}

    
   </style>


  </head>
<body>
  <div class="container">
      <!--<form class="form-horizontal center-block MainForm" role="form" id="UserForm" name="myForm" method="POST"
      ng-submit=“processForm()”>-->
      <form class="form-horizontal center-block MainForm" role="form" id="UserForm" name="myForm">
          <div class="row">
            <div class="col-md-4"> </div>
            <div class="col-md-8"> <h5>Travel and Entertainment Search</h5> </div>
          </div>

          <div class="row">
            <div class="col-md-2"> </div>
            <div class="col-md-2"> 
              <label for="keywordTextDiv">Keyword</label> <span class="star">*</span> 
            </div>
            <div class="col-md-8 formGroup1 invalid-{{myForm.name1.$touched && myForm.name1.$invalid}}"> 
              <input id="keywordTextDiv" class="form-control" name="name1" ng-model="formData.keyword"  style="width:250px;height:28px" ng-required="formData.requireState1"> 

              <div style="color:red" class="invalid-feedback" ng-show="myForm.name1.$touched && myForm.name1.$invalid">Please enter a keyword</div>
              
        
            </div>
          </div>

          <div class="row">
            <div class="col-md-2"> </div>
            <div class="col-md-2"> <label for="categoryTextDiv">Category</label> </div>
            <div class="col-md-8"> <select class="custom-select" id="categoryTextDiv" ng-model="formData.category" ng-init="formData.category=cats[0]" ng-options="x for x in cats" style="width:250px;height: 30px;padding: 0px 10px;">                                     
                                   </select>
            </div>
          </div>


          <div class="row">
            <div class="col-md-2"> </div>
              <div class="col-md-2"> <label for="distanceTextDiv">Distance(miles)</label> </div>
            <div class="col-md-8"> <input class="form-control" type="input" id="distanceTextDiv" ng-model="formData.distance" style="width:250px;height:28px" ng-init="10" placeholder="10" value=""></div>
          </div>

          <div class="row">
            <div class="col-md-2"> </div>
            <div class="col-md-2"> <label>From</label> <span class="star">*</span> </div>
            <div class="col-md-8"> 
              <div class="radio">
                    <label>
                      <input type="radio" ng-value=true ng-model="formData.state1" name="optionsRadios" id="optionsRadios1" ng-checked="formData.checkState" ng-init="initHere()" ng-click="radio1()"> Current Location
                    </label>
              </div>
              <div class="radio">
                    <label>
                      <input for="otherLocationDiv" ng-value=false ng-model="formData.state2" type="radio" name="optionsRadios" id="optionsRadios2" ng-checked="!formData.checkState" ng-click="radio2()"> Other. Please specify:
                    </label>
              </div>
              <div class="invalid-{{formData.warnState && myForm.name2.$touched && myForm.name2.$invalid}}">
                  <input class="locationInput form-control " type="text" id="otherLocationDiv" name="name2" style="width:250px;height:28px" ng-model="formData.location" placeholder="Enter a location" disabled="disabled" ng-required="formData.requireState2" ng-disabled="formData.disableState">
                  <div style="color:red" ng-show="formData.warnState && myForm.name2.$touched && myForm.name2.$invalid">
                          <div style="margin-left: 20px;">Please enter a location</div>
                    </div>
              </div>
            </div>
          </div>


          <div class="row">
            <div class="col-md-2"> </div>
            <div class="form-inline"> <button class="btn btn-primary" type="submit" name="searchButton" ng-click="processForm()" ng-disabled="!formData.keyword || formData.warnState && myForm.name2.$invalid"> <i class="fa fa-search"></i>Search</button>
                                        &nbsp
                  <button type="button" class="btn btn-default Button" ng-click="reset(myForm)">Clear</button>
            </div>
            <div class="col-md-8"> </div>
          </div>

      </form>
      <div class="progress" id="progress">
        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 75%"></div>
      </div>

      
      <div ng-show="toshowResAndFav.show">
        <div class="form-inline align-items-center justify-content-center"> 
            <button class="btn btn-primary" id="btn-res" ng-click="clickResAndFav1()">Results</button>
            &nbsp <button class="btn btn-default btn-non-choose" id="btn-fav" ng-click="clickResAndFav2()">Favorites</button>
        </div>
      </div>
  

    <div ng-show="resAndfavState1.show && !resAndfavState2.show">
        <div ng-show="searchState.show">
          <div style="float:right;margin-bottom: 10px">
            <button class="btn btn-default angleRightButton" ng-disabled="detailButton" ng-click="getDeta(OneDetail,true)">Details <i class="fa fa-angle-right"></i> </button>
          </div>
              <table class="table table-hover">
                    <thead><tr>
                      <th>#</th>
                      <th>Category</th>
                      <th>Name</th>
                      <th>Address</th>
                      <th>Favorite</th>
                      <th>Details</th>
                    </tr></thead>
                    <tbody>
                    <tr ng-repeat="x in results"  ng-style="{'background-color':(OneDetail==x.place_id ? '#fff3cd':'#ffffff')}">
                      <td>{{$index+1}}</td>
                      <td><img ng-if="x.icon!=null" ng-src="{{x.icon}}" style="width: 40px;"></td>
                      <td>{{x.name}}</td>
                      <td>{{x.vicinity}}</td>
                      <td>
                        <button ng-if="inFav(x.place_id)" class="btn btn-default angleRightButton" ng-click="changeFav(x.place_id)"><i class="fa fa-star"></i></button>
                        <button ng-if="!inFav(x.place_id)" class="btn btn-default angleRightButton" ng-click="changeFav(x.place_id)"><i class="far fa-star"></i></button>
                      </td>
                      <td><button class="btn btn-default angleRightButton" ng-click="getDeta($index)"><i class="fa fa-angle-right"></i></button></td>
                    </tr></tbody>
                    
              </table>
               <div class="row align-items-center justify-content-center ">
               <button ng-if="IdxResults>0" ng-click="getPre()" class="btn btn-default angleRightButton"> Previous </button>
               <button ng-if="formData.next!=null || IdxResults+1<AllResults.length" ng-click="getNext()" style="margin-left: 20px" class="btn btn-default angleRightButton" ng-model="formData.next"> Next </button>
             </div>

        </div>

      <div ng-show="detailState.show">
              <h2 style="text-align: center">{{detailObj.name}}</h2>
              <div style="margin: 20px 0px;">
                <button class="btn btn-default detailButton" ng-click="goback()"><i class="fa fa-angle-left"></i>List</button>
                <span style="float:right">
                  <button ng-if="inFav(detailObj.place_id)" class="btn btn-default angleRightButton" ng-click="changeFav(detailObj.place_id)"><i class="fa fa-star"></i></button>
                  <button ng-if="!inFav(detailObj.place_id)" class="btn btn-default angleRightButton" ng-click="changeFav(detailObj.place_id)"><i class="far fa-star"></i></button>

                  <a href={{twitterUrl}}><img style="width: 38px;" src="http://cs-server.usc.edu:45678/hw/hw8/images/Twitter.png"></a>

                </span>
              </div>

              <div style="margin: 20px 0px;">
                <ul class="nav nav-tabs justify-content-end"">
                  <li class="nav-item nav-items1" ng-click="clickInfo()"><a class="nav-link active" href="#"  id="nav-link1">Info</a></li>
                  <li class="nav-item" ng-click="clickPhotos()"><a class="nav-link" id="nav-link2" href="#">Photos</a></li>
                  <li class="nav-item" ng-click="clickMaps()"><a class="nav-link" id="nav-link3" href="#">Maps</a></li>
                  <li class="nav-item" ng-click="clickReviews()"><a class="nav-link" id="nav-link4" href="#">Reviews</a></li>
                </ul>
              </div>

              <div ng-show="infoState.show">    

                  <table class="table table-striped">
                    <tbody>
                      <tr ng-if="detailObj.address!=null">
                        <td>Address</td>
                        <td>{{detailObj.address}}</td>
                      </tr>
                      <tr ng-if="detailObj.phone!=null">
                        <td>Phone Number</td>
                        <td>{{detailObj.phone}}</td>
                      </tr>
                      <tr ng-if="detailObj.price_text!=null">
                        <td>Price Level</td>
                        <td>{{detailObj.price_text}}</td>
                      </tr>
                      <tr ng-if="detailObj.rating!=null">
                        <td>Rating</td>
                        <td>{{detailObj.rating}}
                            <span style="margin-left:10px;width: {{detailObj.rating*14.85}}px;overflow: hidden;display: inline-flex;color:#fd7e14;">
                                <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                            </span>
                         </td>
                      </tr>
                      <tr ng-if="detailObj.url!=null">
                        <td>Google Page</td>
                        <td><a href="{{detailObj.url}}" target="_blank">{{detailObj.url}}</a></td>
                      </tr>
                      <tr ng-if="detailObj.website!=null">
                        <td>Website</td>
                        <td><a href="{{detailObj.website}}" target="_blank">{{detailObj.website}}</a></td>
                      </tr>
                      <tr ng-if="detailObj.opening_hours_text!=null">
                        <td>Hours</td>
                        <td>{{detailObj.opening_hours_text}}
                          <a data-toggle="modal" data-target="#myModal" href="">Daily open hours</a>
                          <div class="modal fade" id="myModal" role="dialog">
                            <div class="modal-dialog">  
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h4 class="modal-title">Open hours</h4>
                                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                                </div>
                                <div class="modal-body">
                                  <table class="table table-normal"><tbody>
                                    <tr ng-repeat="time in detailObj.opening_hours_text2" ng-if="$first" style="background-color:#fff">
                                      <th>{{time.substring(0,time.indexOf(":"))}}</th>
                                      <th>{{time.substring(time.indexOf(" "),time.length)}}</th>
                                    </tr>
                                    <tr ng-repeat="time in detailObj.opening_hours_text2" ng-if="!$first" style="background-color:#fff"> 
                                      <td>{{time.substring(0,time.indexOf(":"))}}</td>
                                      <td>{{time.substring(time.indexOf(" "),time.length)}}</td>
                                    </tr>
                                  </tbody></table>
                                </div>
                                <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
              </div>

              <div ng-show="photoState.show">
                <div style="float:left;width: 24%;margin: 0px 0.5%;">
                  <img class="photoimg rounded" ng-src="{{photos[0].getUrl({'maxWidth': photos[0].width, 'maxHeight': photos[0].height})}}" ng-if="photos[0].getUrl({'maxWidth': 200, 'maxHeight': 200})!=null" onclick="javascript:window.open(this.src)"> 
                  <img class="photoimg rounded" ng-src="{{photos[4].getUrl({'maxWidth': photos[0].width, 'maxHeight': photos[0].height})}}" ng-if="photos[4].getUrl({'maxWidth': 200, 'maxHeight': 200})!=null" onclick="javascript:window.open(this.src)"> 
                  <img class="photoimg rounded" ng-src="{{photos[8].getUrl({'maxWidth': photos[0].width, 'maxHeight': photos[0].height})}}" ng-if="photos[8].getUrl({'maxWidth': 200, 'maxHeight': 200})!=null" onclick="javascript:window.open(this.src)">
                </div> 
                <div style="float:left;width: 24%;margin: 0px 0.5%;">
                  <img class="photoimg rounded" ng-src="{{photos[1].getUrl({'maxWidth': photos[0].width, 'maxHeight': photos[0].height})}}" ng-if="photos[1].getUrl({'maxWidth': 200, 'maxHeight': 200})!=null" onclick="javascript:window.open(this.src)"> 
                  <img class="photoimg rounded" ng-src="{{photos[5].getUrl({'maxWidth': photos[0].width, 'maxHeight': photos[0].height})}}" ng-if="photos[5].getUrl({'maxWidth': 200, 'maxHeight': 200})!=null" onclick="javascript:window.open(this.src)"> 
                  <img class="photoimg rounded" ng-src="{{photos[9].getUrl({'maxWidth': photos[0].width, 'maxHeight': photos[0].height})}}" ng-if="photos[9].getUrl({'maxWidth': 200, 'maxHeight': 200})!=null" onclick="javascript:window.open(this.src)"> 
                </div>
                <div style="float:left;width: 24%;margin: 0px 0.5%;">
                  <img class="photoimg rounded" ng-src="{{photos[2].getUrl({'maxWidth': photos[0].width, 'maxHeight': photos[0].height})}}" ng-if="photos[2].getUrl({'maxWidth': 200, 'maxHeight': 200})!=null" onclick="javascript:window.open(this.src)"> 
                  <img class="photoimg rounded" ng-src="{{photos[6].getUrl({'maxWidth': photos[0].width, 'maxHeight': photos[0].height})}}" ng-if="photos[6].getUrl({'maxWidth': 200, 'maxHeight': 200})!=null" onclick="javascript:window.open(this.src)">
                </div>
                <div style="float:left;width: 24%;margin: 0px 0.5%;" >
                  <img class="photoimg rounded" ng-src="{{photos[3].getUrl({'maxWidth': photos[0].width, 'maxHeight': photos[0].height})}}" ng-if="photos[3].getUrl({'maxWidth': 200, 'maxHeight': 200})!=null" onclick="javascript:window.open(this.src)"> 
                  <img class="photoimg rounded" ng-src="{{photos[7].getUrl({'maxWidth': photos[0].width, 'maxHeight': photos[0].height})}}" ng-if="photos[7].getUrl({'maxWidth': 200, 'maxHeight': 200})!=null" onclick="javascript:window.open(this.src)">  
                </div>
                <div class="alert alert-warning" ng-if="photos==null || photos.length==0">No records.</div>
              </div>

              <div ng-show="mapState.show">
                <form name="myForm2">
                  <div class="form-row">
                    <div class="form-group col-md-4">
                        <label>From</label>
                        <input type="text" class="form-control" id="autocomplete2" required ng-model="fromP" ng-init="fromP=(formData.state ? 'Your location':formData.location)">
                    </div>
                    <div class="form-group col-md-4">
                        <label>To</label>
                        <input type="text" class="form-control" value="{{detailObj.name}}, {{detailObj.address}}" readonly>
                    </div>
                    <div class="form-group col-md-2">
                        <label for="inputMode">Travel Mode</label>
                        <select class="form-control" id="DriveMode">
                          <option value="DRIVING">Driving</option>
                          <option value="WALKING">Walking</option>
                          <option value="BICYCLING">Bicycling</option>
                          <option value="TRANSIT">Transit</option>
                        </select>
                    </div>
                    <div class="form-group col-md-2">
                        <label width="100%">&nbsp;</label>
                        <button type="submit" class="btn btn-primary" ng-click="Direction()" ng-disabled="myForm2.$invalid">Get Directions</button>
                    </div>
                  </div>
                  <div class="form-row">
                    <button type="submit" class="btn btn-default" style="border: 1px solid lightgray;padding: 0px 5px;" ng-click="StreetView()"><img id="ViewBnt" src="http://cs-server.usc.edu:45678/hw/hw8/images/Pegman.png" style="width:40px"></button>
                  </div>
                </form>
                <div id="map" style="height:400px"></div>
                <div id="streetview" style="height:400px"></div>
                <div id="routes"></div>

              </div>

              <div ng-show="reviewState.show" class="reviewsShow">
                 <div class="reviewsShow-dropdown">
                  <span class="dropdown">
                    <a class="btn btn-secondary dropdown-toggle btn-review1" href="" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Google reviews</a>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <a class="dropdown-item" href="" ng-click="clickGoogleReview()">Google Reviews</a>
                      <a class="dropdown-item" href="" ng-click="clickYelpReview();getYelp()">Yelp Reviews</a>
                    </div>
                  </span>
                  <span class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle btn-review2" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      Default Order
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <a class="dropdown-item" href="" ng-click="clickOrderState1()">Default Order</a>
                      <a class="dropdown-item" href="" ng-click="clickOrderState2()">Highest Rating</a>
                      <a class="dropdown-item" href="" ng-click="clickOrderState3()">Least Rating</a>
                      <a class="dropdown-item" href="" ng-click="clickOrderState4()">Most Recent</a>
                      <a class="dropdown-item" href="" ng-click="clickOrderState5()">Least Recent</a>
                    </div>
                  </span>
                 </div>

                 <div class="fade-review" ng-show="reviewState1 && !reviewState2">            
                        <div class="fade-review" ng-show="orderState1">
                           <div class="row center-block" ng-repeat="x in reviews">
                              <div class="card">
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-sm-2 text-center">
                                          <a href="{{x.author_url}}" target="_blank"> <img class="rounded-circle" ng-if="x.profile_photo_url!=null" ng-src="{{x.profile_photo_url}}"></a>
                                        </div>
                                        <div class="col-sm-10">
                                          <div>
                                            <a href="{{x.author_url}}" target="_blank">{{x.author_name}}</a>
                                          </div>
                                            
                                          <div>
                                            <span style="width: {{x.rating*14.85}}px;overflow: hidden;display: inline-flex;color:#fd7e14;">
                                              <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                                            </span>
                                            {{x.time_created}}
                                          </div>

                                          <div>
                                            {{x.text}}
                                          </div>
                                        </div>
                                    </div>
                                </div>
                              </div>
                           </div>
                        </div>

                        <div class="fade-review" ng-show="orderState2">
                           <div class="row center-block" ng-repeat="x in reviews | orderBy :'rating'">
                              <div class="card">
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-sm-2 text-center">
                                          <a href="{{x.author_url}}" target="_blank"> <img class="rounded-circle" ng-if="x.profile_photo_url!=null" ng-src="{{x.profile_photo_url}}"></a>
                                        </div>
                                        <div class="col-sm-10">
                                          <div>
                                            <a href="{{x.author_url}}" target="_blank">{{x.author_name}}</a>
                                          </div>
                                            
                                          <<div>
                                            <span style="width: {{x.rating*14.85}}px;overflow: hidden;display: inline-flex;color:#fd7e14;">
                                              <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                                            </span>
                                            {{x.time_created}}
                                          </div>

                                          <div>
                                            {{x.text}}
                                          </div>
                                        </div>
                                    </div>
                                </div>
                              </div>
                           </div>
                        </div>

                        <div class="fade-review" ng-show="orderState3">
                           <div class="row center-block" ng-repeat="x in reviews | orderBy : '-rating'">
                              <div class="card">
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-sm-2 text-center">
                                          <a href="{{x.author_url}}" target="_blank"> <img class="rounded-circle" ng-if="x.profile_photo_url!=null" ng-src="{{x.profile_photo_url}}"></a>
                                        </div>
                                        <div class="col-sm-10">
                                          <div>
                                            <a href="{{x.author_url}}" target="_blank">{{x.author_name}}</a>
                                          </div>
                                            
                                          <div>
                                            <span style="width: {{x.rating*14.85}}px;overflow: hidden;display: inline-flex;color:#fd7e14;">
                                              <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                                            </span>
                                            {{x.time_created}}
                                          </div>

                                          <div>
                                            {{x.text}}
                                          </div>
                                        </div>
                                    </div>
                                </div>
                              </div>
                           </div>
                        </div>

                        <div class="fade-review" ng-show="orderState4">
                           <div class="row center-block" ng-repeat="x in reviews | orderBy : 'time'">
                              <div class="card">
                                <div class="card-block">
                                    <div class="row">
                                       <div class="col-sm-2 text-center">
                                          <a href="{{x.author_url}}" target="_blank"> <img class="rounded-circle" ng-if="x.profile_photo_url!=null" ng-src="{{x.profile_photo_url}}"></a>
                                        </div>
                                        <div class="col-sm-10">
                                          <div>
                                            <a href="{{x.author_url}}" target="_blank">{{x.author_name}}</a>
                                          </div>
                                            
                                          <div>
                                            <span style="width: {{x.rating*14.85}}px;overflow: hidden;display: inline-flex;color:#fd7e14;">
                                              <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                                            </span>
                                            {{x.time_created}}
                                          </div>

                                          <div>
                                            {{x.text}}
                                          </div>
                                        </div>
                                    </div>
                                </div>
                              </div>
                           </div>
                        </div>

                        <div class="fade-review" ng-show="orderState5">
                           <div class="row center-block" ng-repeat="x in reviews | orderBy : '-time'">
                              <div class="card">
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-sm-2 text-center">
                                          <a href="{{x.author_url}}" target="_blank"> <img class="rounded-circle" ng-if="x.profile_photo_url!=null" ng-src="{{x.profile_photo_url}}"></a>
                                        </div>
                                        <div class="col-sm-10">
                                          <div>
                                            <a href="{{x.author_url}}" target="_blank">{{x.author_name}}</a>
                                          </div>
                                            
                                          <div>
                                            <span style="width: {{x.rating*14.85}}px;overflow: hidden;display: inline-flex;color:#fd7e14;">
                                              <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                                            </span>
                                            {{x.time_created}}
                                          </div>

                                          <div>
                                            {{x.text}}
                                          </div>
                                        </div>
                                    </div>
                                </div>
                              </div>
                           </div>
                        </div>
                   
                <div class="alert alert-warning" ng-if="reviews.length==0">No records.</div>
                 </div>

                 <div class="fade-review" ng-show="!reviewState1 && reviewState2">
                        <div class="fade-review" ng-show="orderState1">
                           <div class="row center-block" ng-repeat="x in yelpDetail">
                              <div class="card">
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-sm-2 text-center">
                                          <a ng-if="x.user.image_url!=null" href="{{x.url}}" target="_blank"><img ng-if="x.user.image_url!=null" class="rounded-circle" ng-src="{{x.user.image_url}}"></a>
                                        </div>
                                        <div class="col-sm-10">
                                          <div>
                                            <a href="{{x.url}}" target="_blank">{{x.user.name}}</a>
                                          </div>
                                            
                                          <div>
                                            <span style="width: {{x.rating*14.85}}px;overflow: hidden;display: inline-flex;color:#fd7e14;">
                                              <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                                            </span>
                                            {{x.time_created}}
                                          </div>

                                          <div>
                                            {{x.text}}
                                          </div>
                                        </div>
                                    </div>
                                </div>
                              </div>
                           </div>
                        </div>

                        <div class="fade-review" ng-show="orderState2">
                           <div class="row center-block" ng-repeat="x in yelpDetail | orderBy : 'rating'">
                              <div class="card">
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-sm-2 text-center">
                                          <a ng-if="x.user.image_url!=null" href="{{x.url}}" target="_blank"><img ng-if="x.user.image_url!=null" class="rounded-circle" ng-src="{{x.user.image_url}}"></a>
                                        </div>
                                        <div class="col-sm-10">
                                          <div>
                                            <a href="{{x.url}}" target="_blank">{{x.user.name}}</a>
                                          </div>
                                            
                                          <div>
                                            <span style="width: {{x.rating*14.85}}px;overflow: hidden;display: inline-flex;color:#fd7e14;">
                                              <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                                            </span>
                                            {{x.time_created}}
                                          </div>

                                          <div>
                                            {{x.text}}
                                          </div>
                                        </div>
                                    </div>
                                </div>
                              </div>
                           </div>
                        </div>

                        <div class="fade-review" ng-show="orderState3">
                           <div class="row center-block" ng-repeat="x in yelpDetail | orderBy : '-rating'">
                              <div class="card">
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-sm-2 text-center">
                                          <a ng-if="x.user.image_url!=null" href="{{x.url}}" target="_blank"><img ng-if="x.user.image_url!=null" class="rounded-circle" ng-src="{{x.user.image_url}}"></a>
                                        </div>
                                        <div class="col-sm-10">
                                          <div>
                                            <a href="{{x.url}}" target="_blank">{{x.user.name}}</a>
                                          </div>
                                            
                                          <div>
                                            <span style="width: {{x.rating*14.85}}px;overflow: hidden;display: inline-flex;color:#fd7e14;">
                                              <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                                            </span>
                                            {{x.time_created}}
                                          </div>

                                          <div>
                                            {{x.text}}
                                          </div>
                                        </div>
                                    </div>
                                </div>
                              </div>
                           </div>
                        </div>

                        <div class="fade-review" ng-show="orderState4">
                           <div class="row center-block" ng-repeat="x in yelpDetail | orderBy : 'time'">
                              <div class="card">
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-sm-2 text-center">
                                          <a ng-if="x.user.image_url!=null" href="{{x.url}}" target="_blank"><img ng-if="x.user.image_url!=null" class="rounded-circle" ng-src="{{x.user.image_url}}"></a>
                                        </div>
                                        <div class="col-sm-10">
                                          <div>
                                            <a href="{{x.url}}" target="_blank">{{x.user.name}}</a>
                                          </div>
                                            
                                          <div>
                                            <span style="width: {{x.rating*14.85}}px;overflow: hidden;display: inline-flex;color:#fd7e14;">
                                              <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                                            </span>
                                            {{x.time_created}}
                                          </div>

                                          <div>
                                            {{x.text}}
                                          </div>
                                        </div>
                                    </div>
                                </div>
                              </div>
                           </div>
                        </div>

                        <div class="fade-review" ng-show="orderState5">
                           <div class="row center-block" ng-repeat="x in yelpDetail | orderBy : '-time'">
                              <div class="card">
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-sm-2 text-center">
                                          <a ng-if="x.user.image_url!=null" href="{{x.url}}" target="_blank"><img ng-if="x.user.image_url!=null" class="rounded-circle" ng-src="{{x.user.image_url}}"></a>
                                        </div>
                                        <div class="col-sm-10">
                                          <div>
                                            <a href="{{x.url}}" target="_blank">{{x.user.name}}</a>
                                          </div>
                                            
                                          <div>
                                            <span style="width: {{x.rating*14.85}}px;overflow: hidden;display: inline-flex;color:#fd7e14;">
                                              <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                                            </span>
                                            {{x.time_created}}
                                          </div>

                                          <div>
                                            {{x.text}}
                                          </div>
                                        </div>
                                    </div>
                                </div>
                              </div>
                           </div>
                        </div>

                        <div class="alert alert-warning" ng-if="yelpDetail.length==0">No records.</div>
              </div>
              </div>
      </div>

    </div>

    <div ng-show="resAndfavState2.show && !resAndfavState1.show">
        <div ng-show="favState" ng-if="favorites.length!=0">
              <table class="table table-striped" >
                    <thead><tr>
                      <th>#</th>
                      <th>Category</th>
                      <th>Name</th>
                      <th>Address</th>
                      <th>Favorite</th>
                      <th>Details</th>
                    </tr></thead>
                    <tbody>
                    <tr ng-repeat="x in favorites">
                      <td>{{$index+1}}</td>
                      <td><img ng-if="x.icon!=null"" ng-src="{{x.icon}}"></td>
                      <td>{{x.name}}</td>
                      <td>{{x.vicinity}}</td>
                      <td>
                        <button class="btn btn-default angleRightButton" ng-click="changeFav(x.place_id)"><i class="fas fa-trash-alt"></i></button>
                      </td>
                      <td><button class="btn btn-default angleRightButton"><i class="fa fa-angle-right"></i></button></td>
                    </tr>
                    </tbody>
              </table>
        </div>

        <div class="alert alert-warning" ng-if="favorites.length==0">No records.</div>


    </div>
  </div>
</div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular-animate.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.7/angular-resource.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>


    <!--
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"> instead of <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"</script>-->
    <script type="text/javascript" async src="https://platform.twitter.com/widgets.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDhSrGlH0RRfnzfwml0LAEtLrd3CLaWnSo&libraries=places&callback=initAuto"
        async defer></script>


    <script type="text/javascript">
    var app = angular.module('myApp', ['ngAnimate']);
    var next_page_token;
    var photoArray;
    var map,marker, panorama;
    var originlat, originlon;
    app.controller( 'validateCtrl', function($scope,$http) {
      $scope.formData = {};
      $scope.formData.state = true;
      $scope.photos = {};
      $scope.reviews = {};
      $scope.cats = ['Default',
              'Airport',
              'Amusement Park',
              'Aquarium',
              'Art Gallery',
              'Bakery',
              'Bar',
              'Beauty Salon',
              'Bowling Alley',
              'Bus Station',
              'Cafe',
              'Campground',
              'Car Rental',
              'Casino',
              'Lodging',
              'Movie Theater',
              'Museum',
              'Night Club',
              'Park',
              'Parking',
              'Restaurant',
              'Shopping Mall',
              'Stadium',
              'Subway Station',
              'Taxi Stand',
              'Train Station',
              'Transit Station',
              'Travel Agency',
              'Zoo'];
/****************************************************/
      $scope.detailObj = {};
/****************************************************/
      $scope.nameState = {};
      $scope.priceState = {};
      $scope.urlState = {};
      $scope.phoneState = {};
      $scope.websiteState = {};
      $scope.addressState = {};
      $scope.timeState = {};

/****************************************************/
      $scope.errorState = {};
      $scope.toshowResAndFav = {};
      $scope.searchState = {};
      $scope.detailState = {};
/****************************************************/
      $scope.infoState = {};
      $scope.photoState = {};
      $scope.mapState = {};
      $scope.reviewState = {};
      $scope.reviewState1 = {};
      $scope.reviewState2 = {};
      $scope.orderState1 = {};
      $scope.orderState2 = {};
      $scope.orderState3 = {};
      $scope.orderState4 = {};
      $scope.orderState5 = {};

      $scope.resAndfavState1 = {};
      $scope.resAndfavState2 = {};

      $scope.starState = {};

      $scope.favorites = new Array();
      $scope.AllResults = new Array();
      $scope.IdxResults = -1;
/****************************************************/
      $scope.detailButton = true;
      $scope.formData.warnState = false;//true;
      $scope.formData.requireState1 = true;
      $scope.formData.requireState2 = true;
      $scope.formData.checkState = true;
      $scope.formData.disableState = true;
      $scope.errorState.show = true;
      $scope.toshowResAndFav.show = true;
      $scope.searchState.show = false;
      $scope.detailState.show = false;
      $scope.nameState = false;
      $scope.priceState = false;
      $scope.urlState = false;
      $scope.phoneState = false;
      $scope.websiteState = false;
      $scope.addressState = false;
      $scope.timeState = false;

      $scope.infoState.show = true;
      $scope.photoState.show = false;
      $scope.mapState.show = false;
      $scope.reviewState.show = false;

      $scope.reviewState1 = true;
      $scope.reviewState2 = false;
      $scope.orderState1 = true;
      $scope.orderState2 = false;
      $scope.orderState3 = false;
      $scope.orderState4 = false;
      $scope.orderState5 = false;

      $scope.resAndfavState1.show = true;
      $scope.resAndfavState2.show = false;

      $scope.starState = true;

      $scope.favState = false;
/****************************************************/

    $scope.checkHere = function() {
    $http({
      method: 'GET',
      url: 'http://ip-api.com/json',
      timeout: 1*60 * 1000
    }).then(function (response){
      data = response.data;
      lat = data.lat;
      lon = data.lon;
      //console.log("This is data:"+data);
    },function (error){
      console.log("Ip-api Website Error, Use Stored value");
      lat = usclat;
      lon = usclon;
      $scope.gotLoc = true;
      //$scope.gotLoc = false;
    });
  };
  

      $scope.processForm = function(){
        
        clickResAndFav1();

        
      $scope.AllResults = new Array();
      $scope.IdxResults = -1;

        document.getElementById("progress").style.display = "block";
        $scope.searchState.show = false;
        $scope.resAndfavState1.show = false;
        $scope.detailButton = false;

        var delayInMilliseconds = 500; //0.5 second
        setTimeout(function() {

          $scope.searchState.show = true;
          $scope.resAndfavState1.show = true;
          $scope.detailButton = true;
          //console.log("Hi~Location is :");

          if (!$scope.formData.distance || $scope.formData.distance.length==0)
              $scope.formData.distance = 10;

          //console.log($scope.formData);

          $.ajax({
            type : "GET",
            url : "/process",
            data : $scope.formData,
            headers : { 'Content-Type': 'application/x-www-form-urlencoded' },
            success: function(data){
              var obj = JSON.parse(data);
              originlat = obj.lat;
              originlon = obj.lon;
              $scope.results = obj.results;
              $scope.formData.next = obj.next_page_token;
              //console.log(obj);
              if(obj.status == "INVALID_REQUEST"){
                $scope.errorState.show = true;
                $scope.toshowResAndFav.show = true;
                $scope.resAndfavState1.show = false;
                $scope.resAndfavState2.show = false;
              }
              $scope.AllResults.push($scope.results);
              $scope.IdxResults ++;
              $scope.$apply();
            }
          });

          document.getElementById("progress").style.display = "none";
        }, delayInMilliseconds);


      };
/****************************************************/
       $scope.reset = function(myForm){
        clickResAndFav1();

myForm.name1.$touched = false;
myForm.name2.$touched = false;

//myForm.optionsRadios[0].checked = true;

      $scope.favorites = new Array();
      $scope.favorites.length = 0;
      $scope.favState = false;

      $scope.AllResults = new Array();
      $scope.IdxResults = -1;

         $scope.toshowResAndFav.show = true;
         $scope.resAndfavState1.show = false;
         $scope.resAndfavState2.show = false;

         $scope.detailState.show = false;
         $scope.detailButton = true;

         $scope.formData.keyword = "";
         $scope.formData.category = "Default";
         $scope.formData.distance = "";
         $scope.formData.location = "";
         $scope.OneDetail = "";

         $scope.formData.checkState = true;
         $scope.formData.disableState = true;

         $scope.formData.warnState = false;


document.getElementsByName("optionsRadios")[0].checked = true;
$scope.formData.checkState = true;

         clickInfo();
         clickGoogleReview();
         clickOrderState1();

         //$scope.favorites = {};
        }  
/****************************************************/
        $scope.radio1 = function(){
          $scope.formData.state = true;
          $scope.formData.checkState = true;
          $scope.formData.disableState = true;
          $scope.formData.warnState = false;
          document.getElementsByClassName("locationInput")[0].disabled = true;
        }

        $scope.radio2 = function(){
           $scope.formData.state = false;
           $scope.formData.checkState = false;
           $scope.formData.disableState = false;
           $scope.formData.warnState = true;
           document.getElementsByClassName("locationInput")[0].disabled = false;
        }

        $scope.clickInfo = function(){
          $(".nav-link").removeClass('active');
          document.getElementById("nav-link1").className += " active";
          $scope.infoState.show = true;
          $scope.photoState.show = false;
          $scope.mapState.show = false;
          $scope.reviewState.show = false;

        }

        function clickInfo(){
          $(".nav-link").removeClass('active');
          document.getElementById("nav-link1").className += " active";
          $scope.infoState.show = true;
          $scope.photoState.show = false;
          $scope.mapState.show = false;
          $scope.reviewState.show = false;

        }

        $scope.clickPhotos = function(){
          $(".nav-link").removeClass('active');
          document.getElementById("nav-link2").className += " active";
          $scope.infoState.show = false;
          $scope.photoState.show = true;
          $scope.mapState.show = false;
          $scope.reviewState.show = false;
        }

        $scope.clickMaps = function(){
          $(".nav-link").removeClass('active');
          document.getElementById("nav-link3").className += " active";
          $scope.infoState.show = false;
          $scope.photoState.show = false;
          $scope.mapState.show = true;
          $scope.reviewState.show = false;
          $scope.fromP= ( $scope.formData.state ? 'Your location': $scope.formData.location);
          map = new google.maps.Map(document.getElementById("map"), {
                  center: {lat: $scope.detailObj.lat, lng: $scope.detailObj.lon},
                  zoom: 15
                });
            marker = new google.maps.Marker({
                position:  {lat: $scope.detailObj.lat, lng: $scope.detailObj.lon},
                map: map
            });
            //map.setMarker(marker);
            // streetview
            panorama = new google.maps.StreetViewPanorama(
                document.getElementById("streetview"), {
                  position: {lat: $scope.detailObj.lat, lng: $scope.detailObj.lon},
                  pov: {
                    heading: 34,
                    pitch: 10
                  }
                });
            map.setStreetView(panorama);
            document.getElementById("map").style.display = "block";
            document.getElementById("streetview").style.display = "none";
        }
        $scope.Direction = function(){
          var originlocation;
          if ($scope.formData.state){ // Your location
            if  ($scope.fromP=="Your location")
              originlocation = {lat: originlat, lng: originlon}
            else 
              originlocation = $scope.fromP;
          }
          else 
            originlocation = $scope.formData.location;
          console.log(originlocation);
          function calculateAndDisplayRoute(directionsService, directionsDisplay) {
              directionsService.route({
                origin: originlocation,
                destination: {lat: $scope.detailObj.lat, lng: $scope.detailObj.lon},
                travelMode: document.getElementById("DriveMode").value,
                provideRouteAlternatives: true
              }, function(response, status) {
                if (status === 'OK') {
                  directionsDisplay.setDirections(response);
                }
              });
            }
          var directionsDisplay = new google.maps.DirectionsRenderer;
          var directionsService = new google.maps.DirectionsService;
          directionsDisplay.setMap(map);
          marker.setMap(null);
          document.getElementById('routes').innerHTML = "";
          directionsDisplay.setPanel(document.getElementById('routes'));
          calculateAndDisplayRoute(directionsService, directionsDisplay); 

        }
        $scope.StreetView = function(){
          if (document.getElementById("ViewBnt").src == "http://cs-server.usc.edu:45678/hw/hw8/images/Pegman.png"){
            document.getElementById("ViewBnt").src = "http://cs-server.usc.edu:45678/hw/hw8/images/Map.png";
            document.getElementById("map").style.display = "none";
            document.getElementById("streetview").style.display = "block";
            panorama.setVisible(true);
          }
          else{
            document.getElementById("ViewBnt").src = "http://cs-server.usc.edu:45678/hw/hw8/images/Pegman.png";
            document.getElementById("map").style.display = "block";
            document.getElementById("streetview").style.display = "none";
            panorama.setVisible(false);
          }
        }

        $scope.clickReviews = function(){
          $(".nav-link").removeClass('active');
          document.getElementById("nav-link4").className += " active";
          $scope.infoState.show = false;
          $scope.photoState.show = false;
          $scope.mapState.show = false;
          $scope.reviewState.show = true;
        }
/****************************************************/
        function clickGoogleReview(){
          $scope.reviewState1 = true;
          $scope.reviewState2 = false;
          $(".btn-review1").html('Google Reviews'+'<span class="caret"></span>');
        }

        $scope.clickGoogleReview = function(){
          $scope.reviewState1 = true;
          $scope.reviewState2 = false;
          $(".btn-review1").html('Google Reviews'+'<span class="caret"></span>');
        }

        $scope.clickYelpReview = function(){
          $scope.reviewState1 = false;
          $scope.reviewState2 = true;
          $(".btn-review1").html('Yelp Reviews'+'<span class="caret"></span>');
        }
/****************************************************/
        function clickOrderState1(){
          $scope.orderState1 = true;
          $scope.orderState2 = false;
          $scope.orderState3 = false;
          $scope.orderState4 = false;
          $scope.orderState5 = false;
          $(".btn-review2").html('Default Order'+'<span class="caret"></span>');
        }

        $scope.clickOrderState1 = function(){
          $scope.orderState1 = true;
          $scope.orderState2 = false;
          $scope.orderState3 = false;
          $scope.orderState4 = false;
          $scope.orderState5 = false;
          $(".btn-review2").html('Default Order'+'<span class="caret"></span>');
        }

        $scope.clickOrderState2 = function(){
          $scope.orderState1 = false;
          $scope.orderState2 = false;
          $scope.orderState3 = true;
          $scope.orderState4 = false;
          $scope.orderState5 = false;
          $(".btn-review2").html('Highest Rating'+'<span class="caret"></span>');
        }

        $scope.clickOrderState3 = function(){
          $scope.orderState1 = false;
          $scope.orderState2 = true;
          $scope.orderState3 = false;
          $scope.orderState4 = false;
          $scope.orderState5 = false;
          $(".btn-review2").html('Lowest Rating'+'<span class="caret"></span>');
        }

        $scope.clickOrderState4 = function(){
          $scope.orderState1 = false;
          $scope.orderState2 = false;
          $scope.orderState3 = false;
          $scope.orderState4 = false;
          $scope.orderState5 = true;
          $(".btn-review2").html('Most Recent'+'<span class="caret"></span>');
        }

        $scope.clickOrderState5 = function(){
          $scope.orderState1 = false;
          $scope.orderState2 = false;
          $scope.orderState3 = false;
          $scope.orderState4 = true;
          $scope.orderState5 = false;
          $(".btn-review2").html('Least Recent'+'<span class="caret"></span>');
        }

        function clickResAndFav1(){
          $scope.resAndfavState1.show = true;
          $scope.resAndfavState2.show = false;
          $("#btn-res").removeClass('btn-primary');
          $("#btn-res").removeClass('btn-non-choose');
          $("#btn-fav").removeClass('btn-primary');
          $("#btn-fav").removeClass('btn-non-choose');
          document.getElementById("btn-res").className += " btn-primary";
          document.getElementById("btn-fav").className += " btn-non-choose";
        }

        $scope.clickResAndFav1 = function(){
          $scope.resAndfavState1.show = true;
          $scope.resAndfavState2.show = false;
          $("#btn-res").removeClass('btn-primary');
          $("#btn-res").removeClass('btn-non-choose');
          $("#btn-fav").removeClass('btn-primary');
          $("#btn-fav").removeClass('btn-non-choose');
          document.getElementById("btn-res").className += " btn-primary";
          document.getElementById("btn-fav").className += " btn-non-choose";
        }

        $scope.clickResAndFav2 = function(){
          $scope.resAndfavState1.show = false;
          $scope.resAndfavState2.show = true;
          $("#btn-res").removeClass('btn-primary');
          $("#btn-res").removeClass('btn-non-choose');
          $("#btn-fav").removeClass('btn-primary');
          $("#btn-fav").removeClass('btn-non-choose');
          document.getElementById("btn-fav").className += " btn-primary";
          document.getElementById("btn-res").className += " btn-non-choose";
          $scope.favState = true;
        }
/****************************************************/
      $scope.getNext = function(){
        if ($scope.IdxResults+1 < $scope.AllResults.length){
           $scope.IdxResults ++;
           $scope.results = $scope.AllResults[$scope.IdxResults];
           if ($scope.IdxResults+1 == $scope.AllResults.length)
             $scope.formData.next = null;
           else 
            scope.formData.next = true;
           return;
        }

        $.ajax({
          type : "GET",
          url : "/process/next",
          data : $scope.formData,
          headers : { 'Content-Type': 'application/x-www-form-urlencoded' },
          success: function(data){
            $scope.results = JSON.parse(data).results;

            $scope.AllResults.push($scope.results);
            $scope.IdxResults ++;

            $scope.formData.next = JSON.parse(data).next_page_token;
            //console.log(JSON.parse(data));
            $scope.$apply();
          }
        });
      }
      $scope.getPre = function(){
        $scope.IdxResults --;
        $scope.results = $scope.AllResults[$scope.IdxResults];
        //$scope.$apply();
      }
/****************************************************/
      $scope.getDeta = function(index, isPlace_id){
        $scope.searchState.show = false;
        $scope.detailState.show = true;
        clickInfo();
        clickGoogleReview();
        clickOrderState1();


        var request;
        if (isPlace_id){
          for (var i=0; i<=$scope.results.length; i++)
            if ($scope.results[i].place_id == index){
              index = i;
              break;
            }
        }
        
          $scope.OneDetail = $scope.results[index].place_id;
          $scope.detailButton = false;
        

        var request = {
            placeId: $scope.results[index].place_id
          };
        
        //console.log("detail~~~~");
        //console.log($scope.results[index].place_id);
        
        

        var service = new google.maps.places.PlacesService(document.createElement('div'));
        service.getDetails(request, callback);

        function callback(place, status) {
          if (status == google.maps.places.PlacesServiceStatus.OK) {
            //console.log(place);

            $scope.detailObj.place_id = place.place_id;
            if(place.name) {
              $scope.detailObj.name = place.name;
              $scope.nameState = true;
            }

            if(place.formatted_address) {
              $scope.detailObj.address = place.formatted_address;
              $scope.addressState = true;
            }

            if(place.international_phone_number) {
              $scope.detailObj.phone = place.international_phone_number;
              $scope.phoneState = true;
            }

            if(place.rating) {
              $scope.detailObj.rating = place.rating;
            }

            if(place.url) {
              $scope.detailObj.url = place.url;
              $scope.urlState = true;
            }

            if(place.website) {
              $scope.detailObj.website = place.website;
              $scope.websiteState = true;
            }

            if(place.price_level) {
              $scope.detailObj.price = place.price_level;
              $scope.detailObj.price_text = "";
              for (var i=0; i<$scope.detailObj.price; i++)
                $scope.detailObj.price_text+="$";
              $scope.priceState = true;
            }

            if(place.opening_hours) {
              var date = new Date();
              var localtime = (date.getHours()*60+date.getMinutes()+place.utc_offset+date.getTimezoneOffset());
              var localday;
              if (localtime>24*60) // next day
                localday = date.getDay()+1;
              else 
                localday = date.getDay();
              localday = localday -1; // date 0 == sunday, openinghour 0 == monday
              if (localday<0)
                localday = 6;
              if (place.opening_hours.open_now)
                $scope.detailObj.opening_hours_text = "Open now:" + place.opening_hours.weekday_text[localday].substring(place.opening_hours.weekday_text[localday].indexOf(" "), place.opening_hours.weekday_text[localday].length)+"    ";
              else $scope.detailObj.opening_hours_text = "Closed    ";
              $scope.detailObj.opening_hours_text2 = [];
              for (var i=localday; i<=6; i++)
                $scope.detailObj.opening_hours_text2.push(place.opening_hours.weekday_text[i]);
              for (var i=0; i<localday; i++)
                $scope.detailObj.opening_hours_text2.push(place.opening_hours.weekday_text[i]);
              $scope.opening_hours = true;
            }

            //if(place.formatted_address) {$scope.detailObj.address = place.formatted_address;
            $scope.detailObj.lat = $scope.results[index].geometry.location.lat;
            $scope.detailObj.lon = $scope.results[index].geometry.location.lng;

              //console.log("detailObj : ");
              //console.log($scope.detailObj);
            $scope.photos = place.photos;
            $scope.reviews = place.reviews;
            if (place.reviews==undefined || place.reviews==null|| Object.keys(place.reviews).length==0){
              $scope.reviews={};
              $scope.reviews.length = 0;
            }
            for (var i=0; i<$scope.reviews.length; i++){
             var time = new Date($scope.reviews[i].time*1000);
             $scope.reviews[i].time_created = time.getFullYear()+"-"+time.getDay().toString().padStart(2,'0')+"-"+time.getMinutes().toString().padStart(2,'0')+" "+time.getHours().toString().padStart(2,'0')+":"+time.getMinutes().toString().padStart(2,'0')+":"+time.getSeconds().toString().padStart(2,'0');
            }

            $scope.twitterUrl = "https://twitter.com/intent/tweet?text=Check Out " + $scope.detailObj.name + " located at " + $scope.detailObj.address + " Website: " + $scope.detailObj.url + "#TravelAndEntertainmentSearch";

            $scope.$apply();
          }
        }
         
       
      }

       $scope.changeFav = function(index){
        var idx = -1;
        for (var i=0; i<$scope.favorites.length; i++)
          if (index == $scope.favorites[i].place_id){
            idx = i;break;
        }
        //console.log(index);
        if (idx!=-1)
            $scope.favorites.splice(idx,1);
        else{
          for (var i=0; i<$scope.results.length; i++)
            if ($scope.results[i].place_id==index){
              $scope.favorites.push($scope.results[i]);
              break;
            }
        }
        //console.log("favorites: ");
        //console.log($scope.favorites);
      }
      $scope.inFav = function(index){
        for (var i=0; i<$scope.favorites.length; i++)
          if (index == $scope.favorites[i].place_id){
            return true;
        }
        return false;
      }

      //,"category":$scope.detailObj.icon,"favorite":'true',"detail":$scope.results[index].place_id])

      $scope.getYelp = function(){
        $scope.reviewState1 = false;
        $scope.reviewState2 = true;
        $scope.yelpDetail = {};
        $scope.yelpDetail.length = 0;

        $.ajax({
          type : "GET",
          url : "/process/yelp",
          data : $scope.detailObj,
          headers : { 'Content-Type': 'application/x-www-form-urlencoded' },
          success: function(data){
            console.log("client side has yelp data:");
            console.log(data);
            $scope.yelpDetail = data;
            for (var i=0; i<$scope.yelpDetail.length; i++){
              $scope.yelpDetail[i].time = new Date($scope.yelpDetail[i].time_created).getTime()/1000;
            }
            $scope.yelpDetail.length = Object.keys(data).length;
            $scope.$apply();
          }
        });
        console.log("GetYelp is done!");
      }

      $scope.goback = function(){
        $scope.searchState.show = true;
        $scope.detailState.show = false;

        clickInfo();
         clickGoogleReview();
         clickOrderState1();

      }

      
  } );
/****************************************************/

    </script>

    <script type="text/javascript">
    function disable1(elem){
      if(elem.checked){
        document.getElementById("otherLocationDiv").disabled=true;     
      }else{
        document.getElementById("otherLocationDiv").disabled=false;        
      }
    }

    function disable2(elem){
      if(elem.checked){
      document.getElementById("otherLocationDiv").disabled=false;     
     }
    }

    function initAuto(){
      autocomplete = new google.maps.places.Autocomplete(
          document.getElementById('otherLocationDiv'), {types:['geocode']}
        );
      autocomplete2 = new google.maps.places.Autocomplete(
          document.getElementById('autocomplete2'), {types:['geocode']}
        );
      
    }

   
    
    
   </script>

  </body>
</html>